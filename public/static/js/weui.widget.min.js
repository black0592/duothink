/**
 * Created by imdante on 2016/11/10.
 */
$(document).ready(function(){

    /**
     * 规格选择价格改变和规格id定义
     */
    $(document).on('click','[data-widget-spec]>.weui-btn',function(){
        var _specId = $(this).data('spec-id'),_price = $(this).data('price');
        $('#spec').attr('value',_specId);
        $(this).addClass('weui-btn_primary').siblings('[data-widget-spec]>.weui-btn').removeClass('weui-btn_primary');
        $('#price-area').html('￥'+_price+'元');
        $('#price').attr('value',_price)
    })
})
/**
 * 购买数量控制
 * @param e
 */
function addLessNum(e){
    var _idNum = $('#num');
    var num = _idNum.val();
    if(e =='add'){
        _idNum.attr('value',Number(num)+1);
    }else {
        _idNum.attr('value',Number(num)-1);
    }
}

/**
 * 转跳url 微信内置不支持reload() 解决方案
 * @param url
 */
function tourl(url){
    window.location.href = url + '?spm='+ spm
}

/**
 * 添加到购物车
 * @param f
 */
function addShopCart(f){
    var formDataSerialize = $(f).serialize();
    var url = '/mshop/index/add_shop_cart';
    var spec = $(f).find('#spec').val();
    if(!spec){
        showAlert(500,'请选择商品规格');
        return false;
    }
    pform(url,formDataSerialize);
    getShopCartCount();
}
function toBuyGoods(f){
    var data = $(f).serialize();
    var spec = $('#spec').val();
    if(spec==''){
        showAlert(500,'请选择商品规格');
        return false;
    }
    $.post('/mshop/pay/create_order',data,function(call){
        if(call.code == 200){
            window.location.href = '/mshop/pay/index?';
        }else {
            showAlert(call.code,call.msg);
        }
    })

}
/**
 * 购物车数量统计
 */
function getShopCartCount(){
    $.get('/mshop/index/get_shopcart_counts',function(json){
        $('.weui-widget-shopcart-badge').html(json.data)
    })
}


/**
 * 页面提示
 * @param code
 * @param msg
 */
function showAlert(code,msg){
    var success = $('#success-toast'),error = $('#error-toast');
    var taost;
    code ==200 ? taost = success : taost = error;
    taost.find('.weui-toast__content').html(msg);
    taost.fadeIn().delay(3000).fadeOut();
}

/**
 * post提交数据
 * @param url
 * @param data
 */
function pform(url,data){
    $.post(url,data,function(json){
        showAlert(json.code,json.msg);
    })
}